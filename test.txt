groups:
- jobs:
  - create-release
  - deploy-wordpress
  name: wordpress-release
- jobs:
  - build-image
  name: build-image
jobs:
- name: build-image
  plan:
  - get: git-repo
    trigger: true
  - params:
      build: git-repo/ci_image
    put: dockerhub-repo
  public: true
  serial: true
- name: create-release
  plan:
  - get: git_repo
    resource: git-repo
    trigger: true
  - file: git_repo/pipeline/tasks/create-release.yml
    task: create_release
- name: deploy-wordpress
  plan:
  - aggregate:
    - get: pipeline
      resource: git-repo
      trigger: true
    run:
      path: pipeline/pipeline/bin/generate-manifest.sh
resources:
- name: git-repo
  source:
    branch: {{pipeline-git-branch}}
    uri: {{pipeline-git-repo}}
  type: git
- name: dockerhub-repo
  source:
    email: {{docker-hub-email}}
    password: {{docker-hub-password}}
    repository: {{docker-create-hub-task-image}}
    username: {{docker-hub-username}}
  type: docker-image

